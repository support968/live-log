<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Live Log</title>

<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400&display=swap" 
rel="stylesheet">

<style>
  body {
    margin: 0;
    background: black;
    color: red;
    font-family: "IBM Plex Mono", monospace;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .wrap {
    text-align: center;
    width: 600px;
  }

  .wake {
    font-size: 14px;
    min-height: 18px;
    margin-bottom: 14px;
  }

  .cursor-line {
    height: 18px;
    margin-bottom: 18px;
    display: none;
  }

  .cursor {
    display: inline-block;
    width: 5px; /* 30% thinner */
    height: 14px;
    background: red;
    animation: blink 1s step-start infinite;
  }

  @keyframes blink {
    50% { opacity: 0; }
  }

  .logs {
    font-size: 12px;
    line-height: 1.6;
    letter-spacing: 0.02em;
  }

  .log {
    opacity: 0;
    transform: translateY(-6px);
    transition: all 0.4s ease;
  }

  .log.show {
    opacity: 1;
    transform: translateY(0);
  }
</style>
</head>

<body>
<div class="wrap">
  <div id="wake" class="wake"></div>

  <div id="cursorLine" class="cursor-line">
    <span class="cursor"></span>
  </div>

  <div id="logs" class="logs"></div>
</div>

<script>
const wakeEl = document.getElementById("wake");
const cursorLine = document.getElementById("cursorLine");
const logsEl = document.getElementById("logs");

const sleep = ms => new Promise(r => setTimeout(r, ms));

/* 1. Wake up 타이핑 */
async function typeWakeUp() {
  const text = "Wake up";
  wakeEl.innerHTML = "";

  for (let i = 0; i < text.length; i++) {
    wakeEl.innerHTML += text[i];
    await sleep(120);
  }

  for (let i = 0; i < 3; i++) {
    await sleep(400);
    wakeEl.innerHTML += ".";
  }
}

/* 2. 커서 표시 */
function showCursor() {
  cursorLine.style.display = "block";
}

/* 3. 로그 한 줄씩 출력 */
async function showLogs() {
  const res = await fetch("/api/messages");
  const data = await res.json();

  data.reverse();

  for (const item of data) {
    const time = new Date(item.created_at).toLocaleString("en-US", {
      hour12: true
    });

    const div = document.createElement("div");
    div.className = "log";
    div.textContent = `${time} SOUTH KOREA ${item.text}`;

    logsEl.appendChild(div);
    requestAnimationFrame(() => div.classList.add("show"));

    await sleep(120);
  }
}

/* 전체 시퀀스 */
(async function start() {
  await typeWakeUp();
  await sleep(300);
  showCursor();
  await sleep(600);
  await showLogs();
})();
</script>
</body>
</html>

