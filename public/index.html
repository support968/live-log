import { useState, useEffect, useRef } from 'react';

export default function Log2Preview() {
  const [visibleLogs, setVisibleLogs] = useState([]);
  const [inputText, setInputText] = useState('');
  const [currentTime, setCurrentTime] = useState('');
  const [isComposing, setIsComposing] = useState(false);
  const inputRef = useRef(null);
  const hiddenInputRef = useRef(null);
  
  const allLogs = [
    { id: 1, timestamp: '06/21/2025, 14:25:03', country: 'South Korea', 
text: 'dksdskdjsdsjkds' },
    { id: 2, timestamp: '06/21/2025, 14:25:05', country: 'South Korea', 
text: 'dksdskdjs4334dsjkds' },
    { id: 3, timestamp: '06/21/2025, 14:25:08', country: 'South Korea', 
text: 'heloosdllsm dkskdkls3232323232232kdmsmds,s' },
    { id: 4, timestamp: '06/21/2025, 14:25:10', country: 'South Korea', 
text: 'dksdskdjsdsjkds' },
    { id: 5, timestamp: '06/21/2025, 14:25:12', country: 'United States', 
text: 'Hello from USA!' },
    { id: 6, timestamp: '06/21/2025, 14:25:15', country: 'Japan', text: 
'こんにちは' },
    { id: 7, timestamp: '06/21/2025, 14:25:18', country: 'South Korea', 
text: 'heloosdllsm dkskdklskdmsmds,s' },
    { id: 8, timestamp: '06/21/2025, 14:25:20', country: 'Germany', text: 
'Hallo aus Deutschland' },
    { id: 9, timestamp: '06/21/2025, 14:25:22', country: 'South Korea', 
text: 'OSS' },
    { id: 10, timestamp: '06/21/2025, 14:25:25', country: 'France', text: 
'Bonjour!' },
    { id: 11, timestamp: '06/21/2025, 14:25:28', country: 'South Korea', 
text: '안녕하세요. 집에언제갈니까?오늘갈니까? 청수아저씨 왔어요...아...' 
},
    { id: 12, timestamp: '06/21/2025, 14:25:30', country: 'United 
Kingdom', text: 'Hello from London' },
  ];

  // 초기 로드 시 하나씩 애니메이션
  useEffect(() => {
    allLogs.forEach((log, index) => {
      setTimeout(() => {
        setVisibleLogs(prev => [...prev, log]);
      }, index * 30);
    });
  }, []);
  
  // 실시간 시간 업데이트 (초 단위)
  useEffect(() => {
    const updateTime = () => {
      const now = new Date();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const year = now.getFullYear();
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');
      setCurrentTime(`${month}/${day}/${year}, 
${hours}:${minutes}:${seconds}`);
    };
    
    updateTime();
    const interval = setInterval(updateTime, 1000);
    return () => clearInterval(interval);
  }, []);
  
  // 입력창으로 스크롤
  useEffect(() => {
    if (inputRef.current) {
      inputRef.current.scrollIntoView({ behavior: 'auto', block: 'center' 
});
    }
  }, [visibleLogs]);
  
  const handleSubmit = () => {
    if (!inputText.trim()) return;
    
    const newLog = {
      id: Date.now(),
      timestamp: currentTime,
      country: 'South Korea',
      text: inputText.trim()
    };
    
    setVisibleLogs(prev => [...prev, newLog]);
    setInputText('');
  };
  
  const handleKeyDown = (e) => {
    if (e.key === 'Enter' && !isComposing) {
      e.preventDefault();
      handleSubmit();
    }
  };
  
  // 화면 클릭하면 입력 포커스
  const handleClick = () => {
    if (hiddenInputRef.current) {
      hiddenInputRef.current.focus();
    }
  };
  
  return (
    <div 
      className="bg-black min-h-screen overflow-auto cursor-text"
      onClick={handleClick}
    >
      <style>{`
        @keyframes blink {
          50% { opacity: 0; }
        }
        .cursor {
          display: inline-block;
          width: 2px;
          height: 1.2em;
          background: #e00000;
          margin-left: 2px;
          animation: blink 1s steps(1) infinite;
          vertical-align: text-bottom;
        }
        .log-text {
          font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
          font-size: 1.65rem;
          font-weight: 500;
          line-height: 1.3;
          letter-spacing: -0.01em;
          color: #e00000;
        }
        .hidden-input {
          position: absolute;
          left: -9999px;
          opacity: 0;
        }
        .log-item {
          display: inline;
          animation: fadeIn 0.15s ease forwards;
        }
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
      `}</style>
      
      {/* 숨겨진 입력창 */}
      <input
        ref={hiddenInputRef}
        type="text"
        value={inputText}
        onChange={(e) => setInputText(e.target.value)}
        onKeyDown={handleKeyDown}
        onCompositionStart={() => setIsComposing(true)}
        onCompositionEnd={() => setIsComposing(false)}
        className="hidden-input"
        autoFocus
      />
      
      {/* 로그 컨테이너 - 왼쪽 정렬, 연속된 텍스트 */}
      <div className="log-text p-4" style={{ wordWrap: 'break-word' }}>
        {visibleLogs.map((log) => (
          <span key={log.id} className="log-item">
            {log.timestamp} {log.country} {log.text}{' '}
          </span>
        ))}
        
        {/* 입력 부분 */}
        <span ref={inputRef}>
          {currentTime} South Korea {inputText}<span 
className="cursor"></span>
        </span>
        
        {/* 아래 여백 */}
        <div className="h-64"></div>
      </div>
    </div>
  );
}
