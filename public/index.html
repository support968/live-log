<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Live Log</title>

<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400&display=swap" 
rel="stylesheet">

<style>
  html, body {
    margin: 0;
    padding: 0;
    background: black;
    color: #ff0000;
    font-family: 'IBM Plex Mono', monospace;
    height: 100%;
  }

  body {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .container {
    text-align: center;
    width: 100%;
  }

  .wake {
    font-size: 14px;
    margin-bottom: 18px;
    min-height: 20px;
  }

  .cursor {
    width: 6px; /* 기존보다 얇게 */
    height: 16px;
    background: #ff0000;
    margin: 0 auto 20px;
    animation: blink 1s steps(1) infinite;
    visibility: hidden;
  }

  @keyframes blink {
    50% { opacity: 0; }
  }

  .logs {
    font-size: 13px;
    line-height: 1.55;
    letter-spacing: 0.02em;
  }

  .log-line {
    opacity: 0;
    animation: fadeIn 0.3s forwards;
  }

  @keyframes fadeIn {
    to { opacity: 1; }
  }
</style>
</head>

<body>
  <div class="container">
    <div class="wake" id="wake"></div>
    <div class="cursor" id="cursor"></div>
    <div class="logs" id="logs"></div>
  </div>

<script>
const wakeEl = document.getElementById('wake');
const cursorEl = document.getElementById('cursor');
const logsEl = document.getElementById('logs');

/* -----------------------------
   1. Wake up 타이핑
----------------------------- */
function typeWakeUp() {
  return new Promise(resolve => {
    const text = "Wake up";
    let i = 0;

    const interval = setInterval(() => {
      wakeEl.textContent += text[i];
      i++;
      if (i === text.length) {
        clearInterval(interval);
        typeDots(resolve);
      }
    }, 120);
  });
}

/* -----------------------------
   1-1. ... 천천히
----------------------------- */
function typeDots(done) {
  let dots = 0;
  const dotInterval = setInterval(() => {
    wakeEl.textContent += ".";
    dots++;
    if (dots === 3) {
      clearInterval(dotInterval);
      done();
    }
  }, 400);
}

/* -----------------------------
   2. 커서 등장
----------------------------- */
function showCursor() {
  return new Promise(resolve => {
    cursorEl.style.visibility = 'visible';
    setTimeout(resolve, 1000);
  });
}

/* -----------------------------
   3. 로그 한 줄씩 출력
----------------------------- */
async function showLogs() {
  const res = await fetch('/api/messages');
  const data = await res.json();

  for (const row of data) {
    const div = document.createElement('div');
    div.className = 'log-line';
    div.textContent =
      new Date(row.created_at).toLocaleString('en-US') +
      ' ' +
      row.country.toUpperCase() +
      ' ' +
      row.text;

    logsEl.appendChild(div);
    await wait(180);
  }
}

function wait(ms) {
  return new Promise(r => setTimeout(r, ms));
}

/* -----------------------------
   실행 순서 고정
----------------------------- */
(async function start() {
  await typeWakeUp();   // 1
  await showCursor();   // 2
  await showLogs();     // 3
})();
</script>
</body>
</html>

