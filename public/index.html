<!doctype html> <html lang="ko"> <head>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Live Log</title>
  <style>
    html, body { height: 100%; margin: 0; background:#000; color:#fff; 
font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 
"Liberation Mono", monospace; }
    #liveLog { height: 100%; display: flex; flex-direction: column; }
    #logList { flex: 1; overflow: auto; padding: 16px; line-height: 1.6; 
white-space: pre-wrap; }
    #logInput { width: 360px; max-width: calc(100% - 32px); margin: 12px 
16px; padding: 8px 10px; border: 0; outline: none; }
    .err { color:#ff3b30; }
  </style>
</head>
<body>
  <div id="liveLog">
    <div id="logList"></div>
    <input id="logInput" autocomplete="off" placeholder="type and hit 
enter" />
  </div>


<script>
document.addEventListener('DOMContentLoaded', () => {
  const API_BASE = "https://live-log-2h3h.onrender.com";
  const WS_URL   = "wss://live-log-2h3h.onrender.com/ws";

  const list  = document.getElementById("logList");
  const input = document.getElementById("logInput");

  const append = (ts, text) => {
    const div = document.createElement("div");
    div.textContent = `${new Date(ts).toLocaleString()}  ${text}`;
    list.appendChild(div);
    list.scrollTop = list.scrollHeight;
  };

  async function loadInitial(){
    try {
      const res = await fetch(`${API_BASE}/api/messages`, { cache: "no-store" });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const rows = await res.json();
      list.innerHTML = "";
      rows.forEach(r => append(r.ts, r.text));
    } catch {
      append(Date.now(), "[error] fetch failed");
    }
  }

  const ws = new WebSocket(WS_URL);

  ws.addEventListener("message", (ev) => {
    try{
      const msg = JSON.parse(ev.data);
      if (msg.type === "message") append(msg.ts, msg.text);
    } catch {}
  });

  input.addEventListener("keydown", (e) => {
    if (e.key !== "Enter") return;
    e.preventDefault();

    const text = input.value.trim();
    if (!text) return;

    input.value = "";

    try {
      ws.send(JSON.stringify({ type: "post", text }));
    } catch {
      append(Date.now(), "[error] send failed");
    }
  });

  loadInitial();
});
</script>


</body>
</html>

